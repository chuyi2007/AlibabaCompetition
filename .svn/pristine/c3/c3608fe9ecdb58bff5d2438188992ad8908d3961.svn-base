package home.s1.alg;

import home.s1.data.SingleRecord;

import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Set;

public abstract class RecommendAlgorithm {
	public enum MLMethods{
		NaiveCF;
	}
	protected List<SingleRecord> history;
	
	public RecommendAlgorithm(List<SingleRecord> ush) {
		history = ush;
	}
	
	abstract public Map<Long, Set<Integer>> execute();
	
	
	public static Map<Integer, Double> getWeight(Map<Integer, Map<Integer, Float>> itemSimilarity) {
		Map<Integer, Double> weight = new HashMap<Integer, Double>();
		for (int key : itemSimilarity.keySet()) {
			double sum = 0;
			for (int key2 : itemSimilarity.get(key).keySet()) {
				sum += itemSimilarity.get(key).get(key2);
			}
			weight.put(key, sum);
		}
		return weight;
	}
	
	public static Map<Integer, Map<Integer, Float>> getItemSimilarity(Map<Integer, Set<Long>> itemToUser) {
		Map<Integer, Map<Integer, Float>> map = new HashMap<Integer, Map<Integer, Float>>();
		for (Integer key1 : itemToUser.keySet()) {
			for (Integer key2 : itemToUser.keySet()) {
				int commonCount = getCommonCount(itemToUser.get(key1), itemToUser.get(key2));
				if (commonCount > 0) {
					double val = 2 * commonCount / (double) (itemToUser.get(key1).size() + itemToUser.get(key2).size());
					Map<Integer, Float> single = new HashMap<Integer, Float>();
					single.put(key2, (float)val);
					map.put(key1, single);
				}
			}
		}
		return map;
	}
	
	public static int getCommonCount(Set<Long> set, Set<Long> set2) {
		int count = 0;
		for (long i : set) {
			for (long j : set2) {
				if (i == j)
					++count;
			}
		}
		return count;
	}
	
	public static Map<Integer, Set<Long>> getItemToUser(List<SingleRecord> recordList) {
		Map<Integer, Set<Long>> itemToUser = new HashMap<Integer, Set<Long>>();
		for (SingleRecord s : recordList) {
			if (!itemToUser.containsKey(s.getItemId())) {
				itemToUser.put(s.getItemId(), new HashSet<Long>());
			}
			itemToUser.get(s.getItemId()).add(s.getUserId());
		}
		return itemToUser;
	}
	
	public static Map<Long, Set<Integer>> getUserToItem(List<SingleRecord> recordList) {
		Map<Long, Set<Integer>> itemToUser = new HashMap<Long, Set<Integer>>();
		for (SingleRecord s : recordList) {
			if (!itemToUser.containsKey(s.getUserId())) {
				itemToUser.put(s.getUserId(), new HashSet<Integer>());
			}
			itemToUser.get(s.getUserId()).add(s.getItemId());
		}
		return itemToUser;
	}
}
